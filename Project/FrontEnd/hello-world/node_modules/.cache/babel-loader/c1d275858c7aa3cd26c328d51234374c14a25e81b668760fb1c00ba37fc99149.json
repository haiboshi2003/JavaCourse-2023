{"ast":null,"code":"import { createVNode, defineComponent, h } from 'vue';\nimport SelectUserModal from \"@/components/Business/Tools/SelectUserModal.vue\";\nimport axios from \"@/api/request\";\nimport { message, Modal } from \"ant-design-vue\";\nimport { ExclamationCircleOutlined } from \"@ant-design/icons-vue\";\nexport default defineComponent({\n  name: \"redemption-service\",\n  components: {\n    SelectUserModal\n  },\n  data() {\n    return {\n      sumShow: false,\n      selectedCustomer: {\n        id: \"\",\n        name: \"\"\n      },\n      dataSource: [],\n      columns: [{\n        title: '银行账户',\n        dataIndex: 'account'\n      }, {\n        title: '基金代码',\n        dataIndex: 'fundId'\n      }, {\n        title: '基金简称',\n        dataIndex: 'shortName'\n      }, {\n        title: '单位净值',\n        dataIndex: 'nav'\n      }, {\n        title: '可用份额',\n        dataIndex: 'unit'\n      }, {\n        title: '一日后可用份额',\n        dataIndex: 'unit1Day'\n      }, {\n        title: '两日后可用份额',\n        dataIndex: 'unit2Day'\n      }, {\n        title: '赎回费率',\n        dataIndex: 'redemptionFee'\n      }, {\n        title: '操作',\n        dataIndex: 'operation'\n      }],\n      amount: \"0.00\",\n      accounts: [],\n      selectedHold: {},\n      confirmOpen: false,\n      confirmLoading: false\n    };\n  },\n  methods: {\n    query() {\n      axios.get(\"http://118.25.19.55:9901/transaction/hold\", {\n        params: {\n          id: this.selectedCustomer.id\n        }\n      }).then(r => {\n        console.log(r);\n        this.dataSource = r.data;\n      }).catch(() => {\n        message.error(\"系统错误，请稍后再试\");\n      });\n    },\n    redemption(record) {\n      if (record !== undefined) {\n        axios.post(\"http://118.25.19.55:9901/transaction/redemption\", {\n          accountId: record.account,\n          unit: parseFloat(this.amount),\n          fundId: record.fundId,\n          userId: this.selectedCustomer.id\n        }).then(r => {\n          if (r.data.success) {\n            message.success(r.data.message);\n\n            /**\r\n             * {\r\n             *   \"estSettlementDate\": \"2023-08-01\",\r\n             *   \"estTransactionAmount\": 0,\r\n             *   \"fee\": 0,\r\n             *   \"message\": \"string\",\r\n             *   \"success\": false,\r\n             *   \"transactionId\": \"string\",\r\n             *   \"transactionUnit\": 0,\r\n             *   \"unitAfter\": 0,\r\n             *   \"unitBefore\": 0\r\n             * }\r\n             */\n            try {\n              Modal.success({\n                title: '赎回成功',\n                content: h('div', {}, [h('p', h('strong', `本次交易份额：${r.data.transactionUnit.toFixed(2)}份`)), h('p', `预计${new Date(r.data.estSettlementDate).toLocaleDateString('zh-CN', {\n                  year: 'numeric',\n                  month: 'long',\n                  day: 'numeric'\n                })}到账${r.data.estTransactionAmount.toFixed(2)}元`), h('hr'), h('p', `交易前持有份额：${r.data.unitBefore.toFixed(2)}份`), h('p', `交易后持有份额：${r.data.unitAfter.toFixed(2)}份`), h('p', `交易手续费：${r.data.fee.toFixed(2)}元`)]),\n                centered: true\n              });\n              this.query();\n            } catch (e) {\n              console.log(e);\n            }\n          } else {\n            message.error(r.data.message);\n          }\n        }).catch(() => {\n          message.error(\"系统错误，请稍后再试\");\n        });\n      }\n    },\n    showPromiseConfirm(record) {\n      if (this.selectedCustomer === null) {\n        message.error(\"未选择客户！\");\n        return;\n      }\n      if (!/^\\d+(\\.\\d+)?$/.test(this.amount)) {\n        message.error(\"交易份额格式错误！\");\n        return;\n      }\n      if (parseFloat(this.amount) <= 0.0) {\n        message.error(\"交易份额不可小于等于0！\");\n        return;\n      }\n      this.selectedHold = record;\n      this.confirmOpen = true;\n      this.confirmLoading = false;\n    },\n    riskLevelChinese(level) {\n      switch (level) {\n        case 0:\n          return \"谨慎型\";\n        case 1:\n          return \"稳健型\";\n        case 2:\n          return \"平衡型\";\n        case 3:\n          return \"进取型\";\n        case 4:\n          return \"激进型\";\n        default:\n          return \"\";\n      }\n    }\n  },\n  mounted() {}\n});","map":{"version":3,"names":["createVNode","defineComponent","h","SelectUserModal","axios","message","Modal","ExclamationCircleOutlined","name","components","data","sumShow","selectedCustomer","id","dataSource","columns","title","dataIndex","amount","accounts","selectedHold","confirmOpen","confirmLoading","methods","query","get","params","then","r","console","log","catch","error","redemption","record","undefined","post","accountId","account","unit","parseFloat","fundId","userId","success","content","transactionUnit","toFixed","Date","estSettlementDate","toLocaleDateString","year","month","day","estTransactionAmount","unitBefore","unitAfter","fee","centered","e","showPromiseConfirm","test","riskLevelChinese","level","mounted"],"sources":["H:\\GitHub-Repository\\hengsheng\\hello-world\\src\\components\\Business\\Redemption.vue"],"sourcesContent":["<script>\r\nimport {createVNode, defineComponent, h} from 'vue'\r\nimport SelectUserModal from \"@/components/Business/Tools/SelectUserModal.vue\";\r\nimport axios from \"@/api/request\";\r\nimport {message, Modal} from \"ant-design-vue\";\r\nimport {ExclamationCircleOutlined} from \"@ant-design/icons-vue\";\r\n\r\nexport default defineComponent({\r\n  name: \"redemption-service\",\r\n  components: {SelectUserModal},\r\n  data() {\r\n    return {\r\n      sumShow: false,\r\n      selectedCustomer: {\r\n        id: \"\",\r\n        name: \"\"\r\n      },\r\n      dataSource: [],\r\n      columns: [\r\n        {\r\n          title: '银行账户',\r\n          dataIndex: 'account',\r\n        },\r\n        {\r\n          title: '基金代码',\r\n          dataIndex: 'fundId',\r\n        },\r\n        {\r\n          title: '基金简称',\r\n          dataIndex: 'shortName',\r\n        },\r\n        {\r\n          title: '单位净值',\r\n          dataIndex: 'nav',\r\n        },\r\n        {\r\n          title: '可用份额',\r\n          dataIndex: 'unit',\r\n        },\r\n        {\r\n          title: '一日后可用份额',\r\n          dataIndex: 'unit1Day',\r\n        },\r\n        {\r\n          title: '两日后可用份额',\r\n          dataIndex: 'unit2Day',\r\n        },\r\n        {\r\n          title: '赎回费率',\r\n          dataIndex: 'redemptionFee',\r\n        },\r\n        {\r\n          title: '操作',\r\n          dataIndex: 'operation',\r\n        },\r\n      ],\r\n      amount: \"0.00\",\r\n      accounts: [],\r\n      selectedHold: {},\r\n      confirmOpen: false,\r\n      confirmLoading: false\r\n    }\r\n  },\r\n  methods: {\r\n    query() {\r\n      axios.get(\"http://118.25.19.55:9901/transaction/hold\", {\r\n        params: {\r\n          id: this.selectedCustomer.id\r\n        }\r\n      }).then(r => {\r\n        console.log(r)\r\n        this.dataSource = r.data;\r\n      }).catch(() => {\r\n        message.error(\"系统错误，请稍后再试\")\r\n      })\r\n    },\r\n    redemption(record) {\r\n      if (record !== undefined) {\r\n        axios.post(\"http://118.25.19.55:9901/transaction/redemption\", {\r\n          accountId: record.account,\r\n          unit: parseFloat(this.amount),\r\n          fundId: record.fundId,\r\n          userId: this.selectedCustomer.id\r\n        }).then(r => {\r\n          if (r.data.success) {\r\n            message.success(r.data.message);\r\n\r\n            /**\r\n             * {\r\n             *   \"estSettlementDate\": \"2023-08-01\",\r\n             *   \"estTransactionAmount\": 0,\r\n             *   \"fee\": 0,\r\n             *   \"message\": \"string\",\r\n             *   \"success\": false,\r\n             *   \"transactionId\": \"string\",\r\n             *   \"transactionUnit\": 0,\r\n             *   \"unitAfter\": 0,\r\n             *   \"unitBefore\": 0\r\n             * }\r\n             */\r\n            try {\r\n              Modal.success({\r\n                title: '赎回成功',\r\n                content: h('div', {}, [\r\n                  h('p', h('strong', `本次交易份额：${r.data.transactionUnit.toFixed(2)}份`)),\r\n                  h('p', `预计${new Date(r.data.estSettlementDate).toLocaleDateString('zh-CN', {\r\n                    year: 'numeric',\r\n                    month: 'long',\r\n                    day: 'numeric'\r\n                  })}到账${r.data.estTransactionAmount.toFixed(2)}元`),\r\n                  h('hr'),\r\n                  h('p', `交易前持有份额：${r.data.unitBefore.toFixed(2)}份`),\r\n                  h('p', `交易后持有份额：${r.data.unitAfter.toFixed(2)}份`),\r\n                  h('p', `交易手续费：${r.data.fee.toFixed(2)}元`),\r\n                ]),\r\n                centered: true\r\n              });\r\n              this.query();\r\n            } catch (e) {\r\n              console.log(e)\r\n            }\r\n          } else {\r\n            message.error(r.data.message);\r\n          }\r\n        }).catch(() => {\r\n          message.error(\"系统错误，请稍后再试\")\r\n        })\r\n      }\r\n    },\r\n    showPromiseConfirm(record) {\r\n      if (this.selectedCustomer === null) {\r\n        message.error(\"未选择客户！\")\r\n        return;\r\n      }\r\n      if (!/^\\d+(\\.\\d+)?$/.test(this.amount)) {\r\n        message.error(\"交易份额格式错误！\")\r\n        return;\r\n      }\r\n      if (parseFloat(this.amount) <= 0.0) {\r\n        message.error(\"交易份额不可小于等于0！\")\r\n        return;\r\n      }\r\n      this.selectedHold = record;\r\n      this.confirmOpen = true;\r\n      this.confirmLoading = false;\r\n    },\r\n    riskLevelChinese(level) {\r\n      switch (level) {\r\n        case 0:\r\n          return \"谨慎型\"\r\n        case 1:\r\n          return \"稳健型\"\r\n        case 2:\r\n          return \"平衡型\"\r\n        case 3:\r\n          return \"进取型\"\r\n        case 4:\r\n          return \"激进型\"\r\n        default:\r\n          return \"\"\r\n      }\r\n    },\r\n  },\r\n  mounted() {\r\n  }\r\n})\r\n</script>\r\n\r\n<template>\r\n  <SelectUserModal v-model:show-modal=\"sumShow\" :handle-ok=\"c=>{selectedCustomer=c;sumShow=false;query()}\"\r\n                   :handle-cancel=\"()=>{sumShow=false}\"/>\r\n  <div class=\"container\">\r\n    <h1>持仓、赎回</h1>\r\n    <h2>欢迎使用持仓、赎回系统。</h2>\r\n\r\n    <a-divider/>\r\n\r\n    <a-space direction=\"vertical\" :size=\"20\">\r\n      <a-space>\r\n        <span>选择交易客户：</span>\r\n        <a-button @click=\"sumShow=true\">选择客户</a-button>\r\n      </a-space>\r\n\r\n      <a-space>\r\n        <span>身份证号或法人代码：</span>\r\n        <a-input :value=\"selectedCustomer.id\" :disabled=\"true\"></a-input>\r\n        <span>名称：</span>\r\n        <a-input :value=\"selectedCustomer.name\" :disabled=\"true\"></a-input>\r\n      </a-space>\r\n\r\n      <a-space>\r\n        <span>交易份额：</span>\r\n        <a-input v-model:value=\"amount\" :status=\"/^\\d+(\\.\\d+)?$/.test(amount)?'':'error'\"\r\n        ></a-input>\r\n        <span>（份）</span>\r\n      </a-space>\r\n    </a-space>\r\n\r\n    <a-divider/>\r\n\r\n    <div class=\"tb-container\">\r\n      <a-table :columns=\"columns\" :data-source=\"dataSource\" rowKey=\"id\" bordered>\r\n        <template #bodyCell=\"{ column, text, record }\">\r\n          <template v-if=\"column.dataIndex==='operation'\">\r\n            <div>\r\n              <a-button @click=\"showPromiseConfirm(record)\">赎回</a-button>\r\n            </div>\r\n          </template>\r\n          <template v-else>\r\n            <div>\r\n              {{ text }}\r\n            </div>\r\n          </template>\r\n        </template>\r\n      </a-table>\r\n    </div>\r\n\r\n    <a-modal v-model:open=\"confirmOpen\" title=\"确认要赎回吗？\" centered :confirm-loading=\"confirmLoading\" @ok=\"()=>{\r\n      redemption(this.selectedHold);\r\n      this.confirmOpen=false;\r\n      this.confirmLoading=false;\r\n    }\">\r\n      <p><strong>请核对赎回信息: </strong></p>\r\n      <hr/>\r\n      <p>{{ `赎回人：${this.selectedCustomer.name}` }}</p>\r\n      <p>{{ `银行账户：${this.selectedHold.account}` }}</p>\r\n      <p>{{ `赎回份额：${this.amount}` }}</p>\r\n    </a-modal>\r\n\r\n  </div>\r\n</template>\r\n\r\n<style scoped>\r\n.container {\r\n  margin: 50px;\r\n}\r\n\r\nh1 {\r\n  font-size: 3em;\r\n}\r\n\r\n.tb-container {\r\n  margin: 20px 0;\r\n}\r\n</style>"],"mappings":"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"},"metadata":{},"sourceType":"module","externalDependencies":[]}