{"ast":null,"code":"import { createVNode, defineComponent, h } from 'vue';\nimport SelectUserModal from \"@/components/Business/Tools/SelectUserModal.vue\";\nimport axios from \"@/api/request\";\nimport { message, Modal } from \"ant-design-vue\";\nimport { ExclamationCircleOutlined } from \"@ant-design/icons-vue\";\nexport default defineComponent({\n  name: \"purchase-service\",\n  components: {\n    SelectUserModal\n  },\n  data() {\n    return {\n      sumShow: false,\n      selectedCustomer: {\n        id: \"\",\n        name: \"\"\n      },\n      dataSource: [],\n      columns: [{\n        title: '基金代码',\n        dataIndex: 'id'\n      }, {\n        title: '基金全称',\n        dataIndex: 'name'\n      }, {\n        title: '基金简称',\n        dataIndex: 'shortName'\n      }, {\n        title: '单位净值',\n        dataIndex: 'nav'\n      }, {\n        title: '状态',\n        dataIndex: 'status'\n      }, {\n        title: '风险等级',\n        dataIndex: 'riskLevel'\n      }, {\n        title: '操作',\n        dataIndex: 'operation'\n      }],\n      amount: \"0.00\",\n      accounts: [],\n      selectedAccount: \"\",\n      selectedFund: \"\",\n      confirmOpen: false,\n      confirmLoading: false\n    };\n  },\n  methods: {\n    query() {\n      axios.get(\"http://118.25.19.55:9901/product\", {\n        params: {\n          current: 1,\n          size: 10000\n        }\n      }).then(r => {\n        console.log(r);\n        this.dataSource = r.data;\n      }).catch(() => {\n        message.error(\"系统错误，请稍后再试\");\n      });\n    },\n    queryAccount() {\n      axios.get(\"http://118.25.19.55:9901/account\", {\n        params: {\n          id: this.selectedCustomer.id,\n          current: 1,\n          size: 10000\n        }\n      }).then(r => {\n        console.log(r);\n        this.accounts = r.data;\n      }).catch(() => {\n        message.error(\"系统错误，请稍后再试\");\n      });\n    },\n    purchase(id) {\n      if (id !== \"\") {\n        axios.post(\"http://118.25.19.55:9901/transaction/purchase\", {\n          accountId: this.selectedAccount,\n          amount: parseFloat(this.amount),\n          fundId: id,\n          userId: this.selectedCustomer.id\n        }).then(r => {\n          if (r.data.success) {\n            message.success(r.data.message);\n\n            /**\r\n             * {\r\n             *   \"balanceAfter\": 0,\r\n             *   \"balanceBefore\": 0,\r\n             *   \"estSettlementDate\": \"2023-08-01\",\r\n             *   \"estTransactionUnit\": 0,\r\n             *   \"fee\": 0,\r\n             *   \"message\": \"string\",\r\n             *   \"success\": false,\r\n             *   \"transactionAmount\": 0,\r\n             *   \"transactionId\": \"string\"\r\n             * }\r\n             */\n            try {\n              Modal.success({\n                title: '申购成功',\n                content: h('div', {}, [h('p', h('strong', `本次交易金额：${r.data.transactionAmount.toFixed(2)}元`)), h('p', `预计${new Date(r.data.estSettlementDate).toLocaleDateString('zh-CN', {\n                  year: 'numeric',\n                  month: 'long',\n                  day: 'numeric'\n                })}到账`), h('hr'), h('p', `交易前账户余额：${r.data.balanceBefore.toFixed(2)}元`), h('p', `交易后账户余额：${r.data.balanceAfter.toFixed(2)}元`), h('p', `交易手续费：${r.data.fee.toFixed(2)}元`)]),\n                centered: true\n              });\n            } catch (e) {\n              console.log(e);\n            }\n          } else {\n            message.error(r.data.message);\n          }\n        }).catch(() => {\n          message.error(\"系统错误，请稍后再试\");\n        });\n      }\n    },\n    showPromiseConfirm(id) {\n      let _this = this;\n      if (this.selectedCustomer === null || this.selectedAccount === \"\") {\n        message.error(\"未选择客户或银行帐户！\");\n        return;\n      }\n      if (!/^\\d+(\\.\\d+)?$/.test(this.amount)) {\n        message.error(\"交易金额格式错误！\");\n        return;\n      }\n      if (parseFloat(this.amount) <= 0.0) {\n        message.error(\"交易金额不可小于等于0！\");\n        return;\n      }\n      this.selectedFund = id;\n      this.confirmOpen = true;\n      this.confirmLoading = false;\n    },\n    riskLevelChinese(level) {\n      switch (level) {\n        case 0:\n          return \"谨慎型\";\n        case 1:\n          return \"稳健型\";\n        case 2:\n          return \"平衡型\";\n        case 3:\n          return \"进取型\";\n        case 4:\n          return \"激进型\";\n        default:\n          return \"\";\n      }\n    }\n  },\n  mounted() {\n    this.query();\n  }\n});","map":{"version":3,"names":["createVNode","defineComponent","h","SelectUserModal","axios","message","Modal","ExclamationCircleOutlined","name","components","data","sumShow","selectedCustomer","id","dataSource","columns","title","dataIndex","amount","accounts","selectedAccount","selectedFund","confirmOpen","confirmLoading","methods","query","get","params","current","size","then","r","console","log","catch","error","queryAccount","purchase","post","accountId","parseFloat","fundId","userId","success","content","transactionAmount","toFixed","Date","estSettlementDate","toLocaleDateString","year","month","day","balanceBefore","balanceAfter","fee","centered","e","showPromiseConfirm","_this","test","riskLevelChinese","level","mounted"],"sources":["H:\\GitHub-Repository\\hengsheng\\hello-world\\src\\components\\Business\\Purchase.vue"],"sourcesContent":["<script>\r\nimport {createVNode, defineComponent, h} from 'vue'\r\nimport SelectUserModal from \"@/components/Business/Tools/SelectUserModal.vue\";\r\nimport axios from \"@/api/request\";\r\nimport {message, Modal} from \"ant-design-vue\";\r\nimport {ExclamationCircleOutlined} from \"@ant-design/icons-vue\";\r\n\r\nexport default defineComponent({\r\n  name: \"purchase-service\",\r\n  components: {SelectUserModal},\r\n  data() {\r\n    return {\r\n      sumShow: false,\r\n      selectedCustomer: {\r\n        id: \"\",\r\n        name: \"\"\r\n      },\r\n      dataSource: [],\r\n      columns: [\r\n        {\r\n          title: '基金代码',\r\n          dataIndex: 'id',\r\n        },\r\n        {\r\n          title: '基金全称',\r\n          dataIndex: 'name',\r\n        },\r\n        {\r\n          title: '基金简称',\r\n          dataIndex: 'shortName',\r\n        },\r\n        {\r\n          title: '单位净值',\r\n          dataIndex: 'nav',\r\n        },\r\n        {\r\n          title: '状态',\r\n          dataIndex: 'status',\r\n        },\r\n        {\r\n          title: '风险等级',\r\n          dataIndex: 'riskLevel',\r\n        },\r\n        {\r\n          title: '操作',\r\n          dataIndex: 'operation',\r\n        },\r\n      ],\r\n      amount: \"0.00\",\r\n      accounts: [],\r\n      selectedAccount: \"\",\r\n      selectedFund: \"\",\r\n      confirmOpen: false,\r\n      confirmLoading: false\r\n    }\r\n  },\r\n  methods: {\r\n    query() {\r\n      axios.get(\"http://118.25.19.55:9901/product\", {\r\n        params: {\r\n          current: 1,\r\n          size: 10000\r\n        }\r\n      }).then(r => {\r\n        console.log(r)\r\n        this.dataSource = r.data;\r\n      }).catch(() => {\r\n        message.error(\"系统错误，请稍后再试\")\r\n      })\r\n    },\r\n    queryAccount() {\r\n      axios.get(\"http://118.25.19.55:9901/account\", {\r\n        params: {\r\n          id: this.selectedCustomer.id,\r\n          current: 1,\r\n          size: 10000\r\n        }\r\n      }).then(r => {\r\n        console.log(r)\r\n        this.accounts = r.data;\r\n      }).catch(() => {\r\n        message.error(\"系统错误，请稍后再试\")\r\n      })\r\n    },\r\n    purchase(id) {\r\n      if (id !== \"\") {\r\n        axios.post(\"http://118.25.19.55:9901/transaction/purchase\", {\r\n          accountId: this.selectedAccount,\r\n          amount: parseFloat(this.amount),\r\n          fundId: id,\r\n          userId: this.selectedCustomer.id\r\n        }).then(r => {\r\n          if (r.data.success) {\r\n            message.success(r.data.message);\r\n\r\n            /**\r\n             * {\r\n             *   \"balanceAfter\": 0,\r\n             *   \"balanceBefore\": 0,\r\n             *   \"estSettlementDate\": \"2023-08-01\",\r\n             *   \"estTransactionUnit\": 0,\r\n             *   \"fee\": 0,\r\n             *   \"message\": \"string\",\r\n             *   \"success\": false,\r\n             *   \"transactionAmount\": 0,\r\n             *   \"transactionId\": \"string\"\r\n             * }\r\n             */\r\n            try {\r\n              Modal.success({\r\n                title: '申购成功',\r\n                content: h('div', {}, [\r\n                  h('p', h('strong', `本次交易金额：${r.data.transactionAmount.toFixed(2)}元`)),\r\n                  h('p', `预计${new Date(r.data.estSettlementDate).toLocaleDateString('zh-CN', {\r\n                    year: 'numeric',\r\n                    month: 'long',\r\n                    day: 'numeric'\r\n                  })}到账`),\r\n                  h('hr'),\r\n                  h('p', `交易前账户余额：${r.data.balanceBefore.toFixed(2)}元`),\r\n                  h('p', `交易后账户余额：${r.data.balanceAfter.toFixed(2)}元`),\r\n                  h('p', `交易手续费：${r.data.fee.toFixed(2)}元`),\r\n                ]),\r\n                centered: true\r\n              });\r\n            } catch (e) {\r\n              console.log(e)\r\n            }\r\n          } else {\r\n            message.error(r.data.message);\r\n          }\r\n        }).catch(() => {\r\n          message.error(\"系统错误，请稍后再试\")\r\n        })\r\n      }\r\n    },\r\n    showPromiseConfirm(id) {\r\n      let _this = this;\r\n      if (this.selectedCustomer === null || this.selectedAccount === \"\") {\r\n        message.error(\"未选择客户或银行帐户！\")\r\n        return;\r\n      }\r\n      if (!/^\\d+(\\.\\d+)?$/.test(this.amount)) {\r\n        message.error(\"交易金额格式错误！\")\r\n        return;\r\n      }\r\n      if (parseFloat(this.amount) <= 0.0) {\r\n        message.error(\"交易金额不可小于等于0！\")\r\n        return;\r\n      }\r\n      this.selectedFund = id;\r\n      this.confirmOpen = true;\r\n      this.confirmLoading = false;\r\n    },\r\n    riskLevelChinese(level) {\r\n      switch (level) {\r\n        case 0:\r\n          return \"谨慎型\"\r\n        case 1:\r\n          return \"稳健型\"\r\n        case 2:\r\n          return \"平衡型\"\r\n        case 3:\r\n          return \"进取型\"\r\n        case 4:\r\n          return \"激进型\"\r\n        default:\r\n          return \"\"\r\n      }\r\n    },\r\n  },\r\n  mounted() {\r\n    this.query();\r\n  }\r\n})\r\n</script>\r\n\r\n<template>\r\n  <SelectUserModal v-model:show-modal=\"sumShow\" :handle-ok=\"c=>{selectedCustomer=c;sumShow=false;queryAccount()}\"\r\n                   :handle-cancel=\"()=>{sumShow=false}\"/>\r\n  <div class=\"container\">\r\n    <h1>申购</h1>\r\n    <h2>欢迎使用申购系统。</h2>\r\n\r\n    <a-divider/>\r\n\r\n    <a-space direction=\"vertical\" :size=\"20\">\r\n      <a-space>\r\n        <span>选择交易客户：</span>\r\n        <a-button @click=\"sumShow=true\">选择客户</a-button>\r\n      </a-space>\r\n\r\n      <a-space>\r\n        <span>身份证号或法人代码：</span>\r\n        <a-input :value=\"selectedCustomer.id\" :disabled=\"true\"></a-input>\r\n        <span>名称：</span>\r\n        <a-input :value=\"selectedCustomer.name\" :disabled=\"true\"></a-input>\r\n        <span>银行账户：</span>\r\n        <a-select v-model:value=\"selectedAccount\" style=\"min-width: 300px\" :disabled=\"accounts.length===0\">\r\n          <a-select-option v-for=\"a in accounts\" :key=\"a.account\" :value=\"a.account\">\r\n            {{ a.account }} - {{ a.bank }} - 可用{{ a.balance }}元\r\n          </a-select-option>\r\n        </a-select>\r\n      </a-space>\r\n\r\n      <a-space>\r\n        <span>交易金额：</span>\r\n        <a-input v-model:value=\"amount\" :status=\"/^\\d+(\\.\\d+)?$/.test(amount)?'':'error'\"\r\n        ></a-input>\r\n        <span>（元）</span>\r\n      </a-space>\r\n    </a-space>\r\n\r\n    <a-divider/>\r\n\r\n    <div class=\"tb-container\">\r\n      <a-table :columns=\"columns\" :data-source=\"dataSource\" rowKey=\"id\" bordered>\r\n        <template #bodyCell=\"{ column, text, record }\">\r\n          <template v-if=\"column.dataIndex==='status'\">\r\n            <div>\r\n              {{ record.status === 0 ? \"开放申购\" : \"暂停申购\" }}\r\n            </div>\r\n          </template>\r\n          <template v-else-if=\"column.dataIndex==='riskLevel'\">\r\n            <div>\r\n              {{ riskLevelChinese(record.riskLevel) }}\r\n            </div>\r\n          </template>\r\n          <template v-else-if=\"column.dataIndex==='operation'\">\r\n            <div>\r\n              <a-button @click=\"showPromiseConfirm(record.id)\">申购</a-button>\r\n            </div>\r\n          </template>\r\n          <template v-else>\r\n            <div>\r\n              {{ text }}\r\n            </div>\r\n          </template>\r\n        </template>\r\n      </a-table>\r\n    </div>\r\n\r\n    <a-modal v-model:open=\"confirmOpen\" title=\"确认要申购吗？\" centered :confirm-loading=\"confirmLoading\" @ok=\"()=>{\r\n      purchase(this.selectedFund);\r\n      this.confirmOpen=false;\r\n      this.confirmLoading=false;\r\n    }\">\r\n      <p><strong>请核对申购信息: </strong></p>\r\n      <hr/>\r\n      <p>{{ `申购人：${this.selectedCustomer.name}` }}</p>\r\n      <p>{{ `银行账户：${this.selectedAccount}` }}</p>\r\n      <p>{{ `申购金额：${this.amount}` }}</p>\r\n    </a-modal>\r\n\r\n  </div>\r\n</template>\r\n\r\n<style scoped>\r\n.container {\r\n  margin: 50px;\r\n}\r\n\r\nh1 {\r\n  font-size: 3em;\r\n}\r\n\r\n.tb-container {\r\n  margin: 20px 0;\r\n}\r\n</style>"],"mappings":"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"},"metadata":{},"sourceType":"module","externalDependencies":[]}