{"ast":null,"code":"import { resolveComponent as _resolveComponent, createVNode as _createVNode, createElementVNode as _createElementVNode, createTextVNode as _createTextVNode, withCtx as _withCtx, openBlock as _openBlock, createElementBlock as _createElementBlock, createCommentVNode as _createCommentVNode, toDisplayString as _toDisplayString, Fragment as _Fragment, pushScopeId as _pushScopeId, popScopeId as _popScopeId } from \"vue\";\nconst _withScopeId = n => (_pushScopeId(\"data-v-2b0d48fa\"), n = n(), _popScopeId(), n);\nconst _hoisted_1 = {\n  class: \"container\"\n};\nconst _hoisted_2 = /*#__PURE__*/_withScopeId(() => /*#__PURE__*/_createElementVNode(\"h1\", null, \"持仓、赎回\", -1 /* HOISTED */));\nconst _hoisted_3 = /*#__PURE__*/_withScopeId(() => /*#__PURE__*/_createElementVNode(\"h2\", null, \"欢迎使用持仓、赎回系统。\", -1 /* HOISTED */));\nconst _hoisted_4 = /*#__PURE__*/_withScopeId(() => /*#__PURE__*/_createElementVNode(\"span\", null, \"选择交易客户：\", -1 /* HOISTED */));\nconst _hoisted_5 = /*#__PURE__*/_withScopeId(() => /*#__PURE__*/_createElementVNode(\"span\", null, \"身份证号或法人代码：\", -1 /* HOISTED */));\nconst _hoisted_6 = /*#__PURE__*/_withScopeId(() => /*#__PURE__*/_createElementVNode(\"span\", null, \"名称：\", -1 /* HOISTED */));\nconst _hoisted_7 = /*#__PURE__*/_withScopeId(() => /*#__PURE__*/_createElementVNode(\"span\", null, \"交易份额：\", -1 /* HOISTED */));\nconst _hoisted_8 = /*#__PURE__*/_withScopeId(() => /*#__PURE__*/_createElementVNode(\"span\", null, \"（份）\", -1 /* HOISTED */));\nconst _hoisted_9 = {\n  class: \"tb-container\"\n};\nconst _hoisted_10 = {\n  key: 0\n};\nconst _hoisted_11 = {\n  key: 1\n};\nconst _hoisted_12 = /*#__PURE__*/_withScopeId(() => /*#__PURE__*/_createElementVNode(\"p\", null, [/*#__PURE__*/_createElementVNode(\"strong\", null, \"请核对赎回信息: \")], -1 /* HOISTED */));\nconst _hoisted_13 = /*#__PURE__*/_withScopeId(() => /*#__PURE__*/_createElementVNode(\"hr\", null, null, -1 /* HOISTED */));\nexport function render(_ctx, _cache, $props, $setup, $data, $options) {\n  const _component_SelectUserModal = _resolveComponent(\"SelectUserModal\");\n  const _component_a_divider = _resolveComponent(\"a-divider\");\n  const _component_a_button = _resolveComponent(\"a-button\");\n  const _component_a_space = _resolveComponent(\"a-space\");\n  const _component_a_input = _resolveComponent(\"a-input\");\n  const _component_a_table = _resolveComponent(\"a-table\");\n  const _component_a_modal = _resolveComponent(\"a-modal\");\n  return _openBlock(), _createElementBlock(_Fragment, null, [_createVNode(_component_SelectUserModal, {\n    \"show-modal\": _ctx.sumShow,\n    \"onUpdate:showModal\": _cache[0] || (_cache[0] = $event => _ctx.sumShow = $event),\n    \"handle-ok\": c => {\n      _ctx.selectedCustomer = c;\n      _ctx.sumShow = false;\n      _ctx.query();\n    },\n    \"handle-cancel\": () => {\n      _ctx.sumShow = false;\n    }\n  }, null, 8 /* PROPS */, [\"show-modal\", \"handle-ok\", \"handle-cancel\"]), _createElementVNode(\"div\", _hoisted_1, [_hoisted_2, _hoisted_3, _createVNode(_component_a_divider), _createVNode(_component_a_space, {\n    direction: \"vertical\",\n    size: 20\n  }, {\n    default: _withCtx(() => [_createVNode(_component_a_space, null, {\n      default: _withCtx(() => [_hoisted_4, _createVNode(_component_a_button, {\n        onClick: _cache[1] || (_cache[1] = $event => _ctx.sumShow = true)\n      }, {\n        default: _withCtx(() => [_createTextVNode(\"选择客户\")]),\n        _: 1 /* STABLE */\n      })]),\n      _: 1 /* STABLE */\n    }), _createVNode(_component_a_space, null, {\n      default: _withCtx(() => [_hoisted_5, _createVNode(_component_a_input, {\n        value: _ctx.selectedCustomer.id,\n        disabled: true\n      }, null, 8 /* PROPS */, [\"value\"]), _hoisted_6, _createVNode(_component_a_input, {\n        value: _ctx.selectedCustomer.name,\n        disabled: true\n      }, null, 8 /* PROPS */, [\"value\"])]),\n      _: 1 /* STABLE */\n    }), _createVNode(_component_a_space, null, {\n      default: _withCtx(() => [_hoisted_7, _createVNode(_component_a_input, {\n        value: _ctx.amount,\n        \"onUpdate:value\": _cache[2] || (_cache[2] = $event => _ctx.amount = $event),\n        status: /^\\d+(\\.\\d+)?$/.test(_ctx.amount) ? '' : 'error'\n      }, null, 8 /* PROPS */, [\"value\", \"status\"]), _hoisted_8]),\n      _: 1 /* STABLE */\n    })]),\n    _: 1 /* STABLE */\n  }), _createVNode(_component_a_divider), _createElementVNode(\"div\", _hoisted_9, [_createVNode(_component_a_table, {\n    columns: _ctx.columns,\n    \"data-source\": _ctx.dataSource,\n    rowKey: \"id\",\n    bordered: \"\"\n  }, {\n    bodyCell: _withCtx(({\n      column,\n      text,\n      record\n    }) => [column.dataIndex === 'operation' ? (_openBlock(), _createElementBlock(\"div\", _hoisted_10, [_createVNode(_component_a_button, {\n      onClick: $event => _ctx.showPromiseConfirm(record)\n    }, {\n      default: _withCtx(() => [_createTextVNode(\"赎回\")]),\n      _: 2 /* DYNAMIC */\n    }, 1032 /* PROPS, DYNAMIC_SLOTS */, [\"onClick\"])])) : (_openBlock(), _createElementBlock(\"div\", _hoisted_11, _toDisplayString(text), 1 /* TEXT */))]),\n    _: 1 /* STABLE */\n  }, 8 /* PROPS */, [\"columns\", \"data-source\"])]), _createVNode(_component_a_modal, {\n    open: _ctx.confirmOpen,\n    \"onUpdate:open\": _cache[3] || (_cache[3] = $event => _ctx.confirmOpen = $event),\n    title: \"确认要赎回吗？\",\n    centered: \"\",\n    \"confirm-loading\": _ctx.confirmLoading,\n    onOk: _cache[4] || (_cache[4] = () => {\n      _ctx.redemption(this.selectedHold);\n      this.confirmOpen = false;\n      this.confirmLoading = false;\n    })\n  }, {\n    default: _withCtx(() => [_hoisted_12, _hoisted_13, _createElementVNode(\"p\", null, _toDisplayString(`赎回人：${this.selectedCustomer.name}`), 1 /* TEXT */), _createElementVNode(\"p\", null, _toDisplayString(`银行账户：${this.selectedHold.account}`), 1 /* TEXT */), _createElementVNode(\"p\", null, _toDisplayString(`赎回份额：${this.amount}`), 1 /* TEXT */)]),\n    _: 1 /* STABLE */\n  }, 8 /* PROPS */, [\"open\", \"confirm-loading\"])])], 64 /* STABLE_FRAGMENT */);\n}","map":{"version":3,"names":["class","_createElementVNode","_createVNode","_component_SelectUserModal","_ctx","sumShow","$event","c","selectedCustomer","query","handle-cancel","_hoisted_1","_hoisted_2","_hoisted_3","_component_a_divider","_component_a_space","direction","size","_hoisted_4","_component_a_button","onClick","_cache","_hoisted_5","_component_a_input","value","id","disabled","_hoisted_6","name","_hoisted_7","amount","status","test","_hoisted_8","_hoisted_9","_component_a_table","columns","dataSource","rowKey","bordered","bodyCell","_withCtx","column","text","record","dataIndex","_createElementBlock","_hoisted_10","showPromiseConfirm","_hoisted_11","_toDisplayString","_component_a_modal","open","confirmOpen","title","centered","confirmLoading","onOk","redemption","selectedHold","_hoisted_12","_hoisted_13","account"],"sources":["H:\\GitHub-Repository\\hengsheng\\hello-world\\src\\components\\Business\\Redemption.vue"],"sourcesContent":["<script>\r\nimport {createVNode, defineComponent, h} from 'vue'\r\nimport SelectUserModal from \"@/components/Business/Tools/SelectUserModal.vue\";\r\nimport axios from \"@/api/request\";\r\nimport {message, Modal} from \"ant-design-vue\";\r\nimport {ExclamationCircleOutlined} from \"@ant-design/icons-vue\";\r\n\r\nexport default defineComponent({\r\n  name: \"redemption-service\",\r\n  components: {SelectUserModal},\r\n  data() {\r\n    return {\r\n      sumShow: false,\r\n      selectedCustomer: {\r\n        id: \"\",\r\n        name: \"\"\r\n      },\r\n      dataSource: [],\r\n      columns: [\r\n        {\r\n          title: '银行账户',\r\n          dataIndex: 'account',\r\n        },\r\n        {\r\n          title: '基金代码',\r\n          dataIndex: 'fundId',\r\n        },\r\n        {\r\n          title: '基金简称',\r\n          dataIndex: 'shortName',\r\n        },\r\n        {\r\n          title: '单位净值',\r\n          dataIndex: 'nav',\r\n        },\r\n        {\r\n          title: '可用份额',\r\n          dataIndex: 'unit',\r\n        },\r\n        {\r\n          title: '一日后可用份额',\r\n          dataIndex: 'unit1Day',\r\n        },\r\n        {\r\n          title: '两日后可用份额',\r\n          dataIndex: 'unit2Day',\r\n        },\r\n        {\r\n          title: '赎回费率',\r\n          dataIndex: 'redemptionFee',\r\n        },\r\n        {\r\n          title: '操作',\r\n          dataIndex: 'operation',\r\n        },\r\n      ],\r\n      amount: \"0.00\",\r\n      accounts: [],\r\n      selectedHold: {},\r\n      confirmOpen: false,\r\n      confirmLoading: false\r\n    }\r\n  },\r\n  methods: {\r\n    query() {\r\n      axios.get(\"http://118.25.19.55:9901/transaction/hold\", {\r\n        params: {\r\n          id: this.selectedCustomer.id\r\n        }\r\n      }).then(r => {\r\n        console.log(r)\r\n        this.dataSource = r.data;\r\n      }).catch(() => {\r\n        message.error(\"系统错误，请稍后再试\")\r\n      })\r\n    },\r\n    redemption(record) {\r\n      if (record !== undefined) {\r\n        axios.post(\"http://118.25.19.55:9901/transaction/redemption\", {\r\n          accountId: record.account,\r\n          unit: parseFloat(this.amount),\r\n          fundId: record.fundId,\r\n          userId: this.selectedCustomer.id\r\n        }).then(r => {\r\n          if (r.data.success) {\r\n            message.success(r.data.message);\r\n\r\n            /**\r\n             * {\r\n             *   \"estSettlementDate\": \"2023-08-01\",\r\n             *   \"estTransactionAmount\": 0,\r\n             *   \"fee\": 0,\r\n             *   \"message\": \"string\",\r\n             *   \"success\": false,\r\n             *   \"transactionId\": \"string\",\r\n             *   \"transactionUnit\": 0,\r\n             *   \"unitAfter\": 0,\r\n             *   \"unitBefore\": 0\r\n             * }\r\n             */\r\n            try {\r\n              Modal.success({\r\n                title: '赎回成功',\r\n                content: h('div', {}, [\r\n                  h('p', h('strong', `本次交易份额：${r.data.transactionUnit.toFixed(2)}份`)),\r\n                  h('p', `预计${new Date(r.data.estSettlementDate).toLocaleDateString('zh-CN', {\r\n                    year: 'numeric',\r\n                    month: 'long',\r\n                    day: 'numeric'\r\n                  })}到账${r.data.estTransactionAmount.toFixed(2)}元`),\r\n                  h('hr'),\r\n                  h('p', `交易前持有份额：${r.data.unitBefore.toFixed(2)}份`),\r\n                  h('p', `交易后持有份额：${r.data.unitAfter.toFixed(2)}份`),\r\n                  h('p', `交易手续费：${r.data.fee.toFixed(2)}元`),\r\n                ]),\r\n                centered: true\r\n              });\r\n              this.query();\r\n            } catch (e) {\r\n              console.log(e)\r\n            }\r\n          } else {\r\n            message.error(r.data.message);\r\n          }\r\n        }).catch(() => {\r\n          message.error(\"系统错误，请稍后再试\")\r\n        })\r\n      }\r\n    },\r\n    showPromiseConfirm(record) {\r\n      if (this.selectedCustomer === null) {\r\n        message.error(\"未选择客户！\")\r\n        return;\r\n      }\r\n      if (!/^\\d+(\\.\\d+)?$/.test(this.amount)) {\r\n        message.error(\"交易份额格式错误！\")\r\n        return;\r\n      }\r\n      if (parseFloat(this.amount) <= 0.0) {\r\n        message.error(\"交易份额不可小于等于0！\")\r\n        return;\r\n      }\r\n      this.selectedHold = record;\r\n      this.confirmOpen = true;\r\n      this.confirmLoading = false;\r\n    },\r\n    riskLevelChinese(level) {\r\n      switch (level) {\r\n        case 0:\r\n          return \"谨慎型\"\r\n        case 1:\r\n          return \"稳健型\"\r\n        case 2:\r\n          return \"平衡型\"\r\n        case 3:\r\n          return \"进取型\"\r\n        case 4:\r\n          return \"激进型\"\r\n        default:\r\n          return \"\"\r\n      }\r\n    },\r\n  },\r\n  mounted() {\r\n  }\r\n})\r\n</script>\r\n\r\n<template>\r\n  <SelectUserModal v-model:show-modal=\"sumShow\" :handle-ok=\"c=>{selectedCustomer=c;sumShow=false;query()}\"\r\n                   :handle-cancel=\"()=>{sumShow=false}\"/>\r\n  <div class=\"container\">\r\n    <h1>持仓、赎回</h1>\r\n    <h2>欢迎使用持仓、赎回系统。</h2>\r\n\r\n    <a-divider/>\r\n\r\n    <a-space direction=\"vertical\" :size=\"20\">\r\n      <a-space>\r\n        <span>选择交易客户：</span>\r\n        <a-button @click=\"sumShow=true\">选择客户</a-button>\r\n      </a-space>\r\n\r\n      <a-space>\r\n        <span>身份证号或法人代码：</span>\r\n        <a-input :value=\"selectedCustomer.id\" :disabled=\"true\"></a-input>\r\n        <span>名称：</span>\r\n        <a-input :value=\"selectedCustomer.name\" :disabled=\"true\"></a-input>\r\n      </a-space>\r\n\r\n      <a-space>\r\n        <span>交易份额：</span>\r\n        <a-input v-model:value=\"amount\" :status=\"/^\\d+(\\.\\d+)?$/.test(amount)?'':'error'\"\r\n        ></a-input>\r\n        <span>（份）</span>\r\n      </a-space>\r\n    </a-space>\r\n\r\n    <a-divider/>\r\n\r\n    <div class=\"tb-container\">\r\n      <a-table :columns=\"columns\" :data-source=\"dataSource\" rowKey=\"id\" bordered>\r\n        <template #bodyCell=\"{ column, text, record }\">\r\n          <template v-if=\"column.dataIndex==='operation'\">\r\n            <div>\r\n              <a-button @click=\"showPromiseConfirm(record)\">赎回</a-button>\r\n            </div>\r\n          </template>\r\n          <template v-else>\r\n            <div>\r\n              {{ text }}\r\n            </div>\r\n          </template>\r\n        </template>\r\n      </a-table>\r\n    </div>\r\n\r\n    <a-modal v-model:open=\"confirmOpen\" title=\"确认要赎回吗？\" centered :confirm-loading=\"confirmLoading\" @ok=\"()=>{\r\n      redemption(this.selectedHold);\r\n      this.confirmOpen=false;\r\n      this.confirmLoading=false;\r\n    }\">\r\n      <p><strong>请核对赎回信息: </strong></p>\r\n      <hr/>\r\n      <p>{{ `赎回人：${this.selectedCustomer.name}` }}</p>\r\n      <p>{{ `银行账户：${this.selectedHold.account}` }}</p>\r\n      <p>{{ `赎回份额：${this.amount}` }}</p>\r\n    </a-modal>\r\n\r\n  </div>\r\n</template>\r\n\r\n<style scoped>\r\n.container {\r\n  margin: 50px;\r\n}\r\n\r\nh1 {\r\n  font-size: 3em;\r\n}\r\n\r\n.tb-container {\r\n  margin: 20px 0;\r\n}\r\n</style>"],"mappings":";;;EA2KOA,KAAK,EAAC;AAAW;gEACpBC,mBAAA,CAAc,YAAV,OAAK;gEACTA,mBAAA,CAAqB,YAAjB,cAAY;gEAMZA,mBAAA,CAAoB,cAAd,SAAO;gEAKbA,mBAAA,CAAuB,cAAjB,YAAU;gEAEhBA,mBAAA,CAAgB,cAAV,KAAG;gEAKTA,mBAAA,CAAkB,cAAZ,OAAK;gEAGXA,mBAAA,CAAgB,cAAV,KAAG;;EAMRD,KAAK,EAAC;AAAc;;;;;;;iEAsBvBC,mBAAA,CAAiC,Y,aAA9BA,mBAAA,CAA0B,gBAAlB,WAAS,E;iEACpBA,mBAAA,CAAK;;;;;;;;;6DAtDTC,YAAA,CACuDC,0BAAA;IAD9B,YAAU,EAAEC,IAAA,CAAAC,OAAO;8DAAPD,IAAA,CAAAC,OAAO,GAAAC,MAAA;IAAG,WAAS,EAAEC,CAAC;MAAGH,IAAA,CAAAI,gBAAgB,GAACD,CAAC;MAACH,IAAA,CAAAC,OAAO;MAAOD,IAAA,CAAAK,KAAK;IAAA;IAClF,eAAa,EAAAC,CAAA;MAAON,IAAA,CAAAC,OAAO;IAAA;yEAC7CJ,mBAAA,CA0DM,OA1DNU,UA0DM,GAzDJC,UAAc,EACdC,UAAqB,EAErBX,YAAA,CAAYY,oBAAA,GAEZZ,YAAA,CAmBUa,kBAAA;IAnBDC,SAAS,EAAC,UAAU;IAAEC,IAAI,EAAE;;sBACnC,MAGU,CAHVf,YAAA,CAGUa,kBAAA;wBAFR,MAAoB,CAApBG,UAAoB,EACpBhB,YAAA,CAA+CiB,mBAAA;QAApCC,OAAK,EAAAC,MAAA,QAAAA,MAAA,MAAAf,MAAA,IAAEF,IAAA,CAAAC,OAAO;;0BAAO,MAAI,C,iBAAJ,MAAI,E;;;;QAGtCH,YAAA,CAKUa,kBAAA;wBAJR,MAAuB,CAAvBO,UAAuB,EACvBpB,YAAA,CAAiEqB,kBAAA;QAAvDC,KAAK,EAAEpB,IAAA,CAAAI,gBAAgB,CAACiB,EAAE;QAAGC,QAAQ,EAAE;0CACjDC,UAAgB,EAChBzB,YAAA,CAAmEqB,kBAAA;QAAzDC,KAAK,EAAEpB,IAAA,CAAAI,gBAAgB,CAACoB,IAAI;QAAGF,QAAQ,EAAE;;;QAGrDxB,YAAA,CAKUa,kBAAA;wBAJR,MAAkB,CAAlBc,UAAkB,EAClB3B,YAAA,CACWqB,kBAAA;QADMC,KAAK,EAAEpB,IAAA,CAAA0B,MAAM;8DAAN1B,IAAA,CAAA0B,MAAM,GAAAxB,MAAA;QAAGyB,MAAM,kBAAkBC,IAAI,CAAC5B,IAAA,CAAA0B,MAAM;oDAEpEG,UAAgB,C;;;;MAIpB/B,YAAA,CAAYY,oBAAA,GAEZb,mBAAA,CAeM,OAfNiC,UAeM,GAdJhC,YAAA,CAaUiC,kBAAA;IAbAC,OAAO,EAAEhC,IAAA,CAAAgC,OAAO;IAAG,aAAW,EAAEhC,IAAA,CAAAiC,UAAU;IAAEC,MAAM,EAAC,IAAI;IAACC,QAAQ,EAAR;;IACrDC,QAAQ,EAAAC,QAAA,CACjB,CAIW;MALUC,MAAM;MAAEC,IAAI;MAAEC;IAAM,OACzBF,MAAM,CAACG,SAAS,oB,cAC9BC,mBAAA,CAEM,OAAAC,WAAA,GADJ7C,YAAA,CAA2DiB,mBAAA;MAAhDC,OAAK,EAAAd,MAAA,IAAEF,IAAA,CAAA4C,kBAAkB,CAACJ,MAAM;;wBAAG,MAAE,C,iBAAF,IAAE,E;;yEAIlDE,mBAAA,CAEM,OAAAG,WAAA,EAAAC,gBAAA,CADDP,IAAI,kB;;mDAOjBzC,YAAA,CAUUiD,kBAAA;IAVOC,IAAI,EAAEhD,IAAA,CAAAiD,WAAW;yDAAXjD,IAAA,CAAAiD,WAAW,GAAA/C,MAAA;IAAEgD,KAAK,EAAC,SAAS;IAACC,QAAQ,EAAR,EAAQ;IAAE,iBAAe,EAAEnD,IAAA,CAAAoD,cAAc;IAAGC,IAAE,EAAApC,MAAA,QAAAA,MAAA;MAAejB,IAAA,CAAAsD,UAAU,MAAMC,YAAY;WAAeN,WAAW;WAAoBG,cAAc;;;sBAKvM,MAAiC,CAAjCI,WAAiC,EACjCC,WAAK,EACL5D,mBAAA,CAAgD,WAAAiD,gBAAA,aAA9B1C,gBAAgB,CAACoB,IAAI,oBACvC3B,mBAAA,CAAgD,WAAAiD,gBAAA,cAA7BS,YAAY,CAACG,OAAO,oBACvC7D,mBAAA,CAAkC,WAAAiD,gBAAA,cAAfpB,MAAM,mB"},"metadata":{},"sourceType":"module","externalDependencies":[]}